<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Carros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: #f8fafc;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }
        
        .status-urgent {
            background: #fef2f2;
            color: #991b1b;
            border-left: 4px solid #f87171;
        }
        
        .status-warning {
            background: #fffbeb;
            color: #92400e;
            border-left: 4px solid #fbbf24;
        }
        
        .status-ok {
            background: #f0fdf4;
            color: #166534;
            border-left: 4px solid #4ade80;
        }
        
        .status-neutral {
            background: #f8fafc;
            color: #475569;
            border-left: 4px solid #94a3b8;
        }
        
        .btn-primary {
            background: #e2e8f0;
            color: #475569;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #cbd5e1;
            transform: translateY(-1px);
        }
        
        .config-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .confirm-modal.show {
            display: flex;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-4 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center w-12 h-12 bg-white/20 rounded-full mb-3">
                <span class="text-2xl">üöó</span>
            </div>
            <h1 class="text-2xl font-bold text-slate-700 mb-2">Dashboard de Carros</h1>
            <p class="text-slate-500 text-sm">Gerencie os eventos dos seus ve√≠culos</p>
        </div>



        <!-- Navigation -->
        <div class="flex justify-center mb-8">
            <div class="glass-card rounded-2xl p-2 flex space-x-2">
                <button id="dashboardBtn" onclick="showDashboard()" class="px-8 py-3 rounded-xl font-semibold transition-all duration-300 bg-slate-200 text-slate-700 shadow-sm">
                    üìä Dashboard
                </button>
                <button id="carsBtn" onclick="showCars()" class="px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-slate-500 hover:text-slate-700 hover:bg-slate-100">
                    üöó Gerir Carros
                </button>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboardView">
            <!-- Events Timeline -->
            <div class="glass-card rounded-3xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-slate-700 mb-8 flex items-center">
                    <span class="mr-4">üìÖ</span>
                    Pr√≥ximos Eventos
                </h2>
                <div id="eventsTimeline">
                    <!-- Events will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Cars Management View -->
        <div id="carsView" style="display: none;">


            <!-- Add Car Form -->
            <div class="glass-card rounded-3xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-slate-700 mb-8 flex items-center">
                    <span class="mr-4">‚ûï</span>
                    Adicionar Novo Carro
                </h2>
                <form id="carForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Marca</label>
                        <input type="text" id="carBrand" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200" placeholder="Ex: BMW, Mercedes, Toyota...">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Modelo</label>
                        <input type="text" id="carModel" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200" placeholder="Ex: X3, A4, C-Class">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Matr√≠cula</label>
                        <input type="text" id="licensePlate" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200" placeholder="Ex: 12-AB-34">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Pr√≥xima Inspe√ß√£o</label>
                        <input type="date" id="inspectionDate" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Vencimento do Seguro</label>
                        <input type="date" id="insuranceDate" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Pagamento do IUC</label>
                        <input type="date" id="iucDate" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Logo da Marca (opcional)</label>
                        <div class="flex items-center space-x-3">
                            <input type="file" id="brandLogo" accept="image/*" class="hidden">
                            <button type="button" onclick="document.getElementById('brandLogo').click()" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl hover:border-purple-300 transition-all duration-200 text-gray-600 hover:text-purple-600 font-medium">
                                üì∑ Selecionar Imagem
                            </button>
                            <div id="logoPreview" class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-gray-400 text-xs">
                                Logo
                            </div>
                        </div>
                    </div>
                    <div class="flex items-end">
                        <button type="submit" class="w-full btn-primary text-indigo-800 font-semibold py-4 px-6 rounded-xl">
                            <span class="text-lg mr-2">üöó</span>
                            Adicionar Carro
                        </button>
                    </div>
                </form>
            </div>

            <!-- Cars List -->
            <div id="carsList" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
                <!-- Cars will be displayed here -->
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-20">
            <div class="inline-flex items-center justify-center w-32 h-32 bg-white/20 rounded-full mb-8">
                <span class="text-6xl">üöó</span>
            </div>
            <h3 class="text-2xl font-bold text-slate-700 mb-4">Nenhum carro registado</h3>
            <p class="text-slate-500 text-lg mb-8">Comece adicionando o seu primeiro ve√≠culo</p>
            <button onclick="showCars()" class="btn-primary font-semibold py-4 px-8 rounded-xl">
                <span class="text-lg mr-2">‚ûï</span>
                Adicionar Primeiro Carro
            </button>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="confirm-modal">
            <div class="glass-card rounded-3xl p-8 max-w-md mx-4">
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
                        <span class="text-3xl">üóëÔ∏è</span>
                    </div>
                    <h3 class="text-xl font-bold text-slate-700 mb-2">Eliminar Carro</h3>
                    <p class="text-slate-500" id="confirmMessage">Tem a certeza que deseja eliminar este carro?</p>
                </div>
                <div class="flex space-x-4">
                    <button onclick="cancelDelete()" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all duration-300">
                        Cancelar
                    </button>
                    <button onclick="confirmDelete()" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300">
                        Eliminar
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        let cars = JSON.parse(localStorage.getItem('cars')) || [];
        let config = {
            apiKey: '$2a$10$p2B6kIgO16ed1z49Jr3RNeVTN0uabdyVXVjlSsqctFLPfxeuymD.u',
            binId: '68e4d92dd0ea881f40983660'
        };

        // JSONBin API functions
        async function saveToJSONBin(data) {
            if (!config.apiKey) {
                console.log('JSONBin n√£o configurado, usando localStorage');
                return;
            }

            try {
                const url = config.binId 
                    ? `https://api.jsonbin.io/v3/b/${config.binId}`
                    : 'https://api.jsonbin.io/v3/b';
                
                const method = config.binId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': config.apiKey,
                        'X-Bin-Name': 'carros-dashboard'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Dados salvos no JSONBin com sucesso');
                } else {
                    throw new Error('Erro ao salvar no JSONBin');
                }
            } catch (error) {
                console.error('Erro JSONBin:', error);
            }
        }

        async function loadFromJSONBin() {
            if (!config.apiKey || !config.binId) {
                return null;
            }

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${config.binId}/latest`, {
                    headers: {
                        'X-Master-Key': config.apiKey
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    return result.record;
                } else {
                    throw new Error('Erro ao carregar do JSONBin');
                }
            } catch (error) {
                console.error('Erro ao carregar JSONBin:', error);
                return null;
            }
        }

        function saveCars() {
            localStorage.setItem('cars', JSON.stringify(cars));
            saveToJSONBin(cars);
        }

        async function loadCars() {
            if (config.apiKey && config.binId) {
                const cloudData = await loadFromJSONBin();
                if (cloudData) {
                    cars = cloudData;
                    localStorage.setItem('cars', JSON.stringify(cars));
                    return;
                }
            }
            // Fallback to localStorage
            cars = JSON.parse(localStorage.getItem('cars')) || [];
        }

        function getDaysUntil(dateString) {
            const today = new Date();
            const targetDate = new Date(dateString);
            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function getStatusClass(days) {
            if (days < 0) return 'status-urgent';      // Vencido - vermelho
            if (days <= 7) return 'status-warning';    // Pr√≥ximo (7 dias) - amarelo
            if (days <= 30) return 'status-neutral';   // Aten√ß√£o (30 dias) - cinza
            return 'status-ok';                        // OK (mais de 30 dias) - verde
        }

        function getStatusText(days) {
            if (days < 0) return `Vencido h√° ${Math.abs(days)} dias`;
            if (days === 0) return 'Vence hoje';
            if (days === 1) return 'Vence amanh√£';
            return `${days} dias`;
        }

        function getBrandIcon(brand, carLogo = null) {
            // Check if car has a custom logo
            if (carLogo) {
                return `<img src="${carLogo}" alt="${brand}" class="w-8 h-8 object-contain rounded">`;
            }

            // Fallback to emoji icons
            const brandIcons = {
                'audi': 'üÖ∞Ô∏è',
                'bmw': 'üîµ',
                'mercedes': '‚≠ê',
                'volkswagen': 'üî∑',
                'ford': 'üîµ',
                'opel': '‚ö°',
                'peugeot': 'ü¶Å',
                'renault': 'üíé',
                'citroen': 'üî∫',
                'fiat': 'üáÆüáπ',
                'seat': 'üá™üá∏',
                'skoda': 'üçÄ',
                'toyota': 'üî¥',
                'honda': 'üÖ∑',
                'nissan': 'üîµ',
                'mazda': 'üåÄ',
                'hyundai': 'üÖ∑',
                'kia': 'üî¥',
                'volvo': 'üá∏üá™',
                'jaguar': 'üêÜ',
                'landrover': 'üü¢',
                'porsche': 'üèéÔ∏è',
                'mini': 'üîµ',
                'alfa': 'üêç',
                'jeep': 'üöô',
                'dacia': 'üî∑',
                'tesla': '‚ö°',
                'lexus': 'üî∂',
                'infiniti': '‚ôæÔ∏è',
                'acura': 'üÖ∞Ô∏è',
                'subaru': '‚≠ê',
                'mitsubishi': 'üî∫',
                'suzuki': 'üîµ',
                'isuzu': 'üî∑',
                'smart': 'üîµ',
                'ds': 'üíé',
                'lancia': 'üî∑',
                'saab': 'üá∏üá™'
            };
            
            return brandIcons[brand?.toLowerCase()] || 'üöó';
        }



        function getEventIcon(type) {
            switch(type) {
                case 'inspection': return 'üîß';
                case 'insurance': return 'üõ°Ô∏è';
                case 'iuc': return 'üí∞';
                default: return '‚ö†Ô∏è';
            }
        }

        function getEventName(type) {
            switch(type) {
                case 'inspection': return 'Inspe√ß√£o';
                case 'insurance': return 'Seguro';
                case 'iuc': return 'IUC';
                default: return 'Evento';
            }
        }

        function getAllEvents() {
            const events = [];
            
            cars.forEach((car, carIndex) => {
                const eventTypes = [
                    { type: 'inspection', date: car.inspectionDate },
                    { type: 'insurance', date: car.insuranceDate },
                    { type: 'iuc', date: car.iucDate }
                ];

                eventTypes.forEach(eventType => {
                    events.push({
                        carName: car.name,
                        licensePlate: car.licensePlate,
                        brand: car.brand,
                        type: eventType.type,
                        date: eventType.date,
                        days: getDaysUntil(eventType.date)
                    });
                });
            });

            // Sort by date (closest first)
            events.sort((a, b) => a.days - b.days);
            return events;
        }

        function renderDashboard() {
            const eventsTimeline = document.getElementById('eventsTimeline');
            const events = getAllEvents();

            if (events.length === 0) {
                eventsTimeline.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-6">üìÖ</div>
                        <p class="text-gray-500 text-lg">Nenhum evento encontrado. Adicione carros para ver os pr√≥ximos eventos.</p>
                    </div>
                `;
                return;
            }

            let currentMonth = '';
            let timelineHTML = '';

            events.forEach((event, index) => {
                const eventDate = new Date(event.date);
                const monthYear = eventDate.toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' });
                
                // Add month separator
                if (monthYear !== currentMonth) {
                    currentMonth = monthYear;
                    timelineHTML += `
                        <div class="flex items-center mb-6 ${index > 0 ? 'mt-10' : ''}">
                            <div class="flex-1 h-px bg-gray-300"></div>
                            <span class="px-6 py-2 text-sm font-bold text-gray-600 bg-gray-100 rounded-full">${monthYear.charAt(0).toUpperCase() + monthYear.slice(1)}</span>
                            <div class="flex-1 h-px bg-gray-300"></div>
                        </div>
                    `;
                }

                const statusClass = getStatusClass(event.days);
                const statusText = getStatusText(event.days);
                
                timelineHTML += `
                    <div class="p-4 mb-4 rounded-2xl ${statusClass} card-hover">
                        <!-- Mobile Layout -->
                        <div class="block md:hidden">
                            <div class="flex items-start space-x-3 mb-4">
                                <div class="bg-white/30 p-2 rounded-lg flex-shrink-0 flex items-center justify-center w-12 h-12">
                                    ${getBrandIcon(event.brand, cars.find(c => c.licensePlate === event.licensePlate)?.logo)}
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="font-semibold text-base leading-tight mb-1">${event.carName}</h3>
                                    <p class="opacity-80 font-medium text-sm leading-tight">${event.licensePlate}</p>
                                    <p class="opacity-90 font-medium text-sm text-current">${getEventIcon(event.type)} ${getEventName(event.type)}</p>
                                </div>
                            </div>
                            <div class="flex items-center justify-between pt-2 border-t border-white/20">
                                <div class="flex-1">
                                    <div class="font-semibold text-base mb-1">${formatDate(event.date)}</div>
                                    <div class="opacity-90 font-medium text-sm">${statusText}</div>
                                </div>
                                <button onclick="addToGoogleCalendar(event, ${index})" class="bg-white/40 hover:bg-white/60 text-gray-700 w-10 h-10 rounded-lg transition-all duration-200 flex items-center justify-center flex-shrink-0 ml-3">
                                    <span class="text-lg">üìÖ</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Desktop Layout -->
                        <div class="hidden md:flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="bg-white/20 p-3 rounded-lg flex items-center justify-center w-16 h-16">
                                    ${getBrandIcon(event.brand, cars.find(c => c.licensePlate === event.licensePlate)?.logo)}
                                </div>
                                <div>
                                    <div class="flex items-center space-x-3 mb-1">
                                        <h3 class="font-semibold text-lg">${event.carName}</h3>
                                        <span class="opacity-60">‚Ä¢</span>
                                        <span class="opacity-90 font-medium text-sm">${event.licensePlate}</span>
                                    </div>
                                    <p class="opacity-90 font-medium text-sm">${getEventIcon(event.type)} ${getEventName(event.type)}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <button onclick="addToGoogleCalendar(event, ${index})" class="bg-white/40 hover:bg-white/60 text-gray-700 w-12 h-12 rounded-lg transition-all duration-200 flex items-center justify-center">
                                    <span class="text-xl">üìÖ</span>
                                </button>
                                <div class="text-right">
                                    <div class="font-semibold text-base">${formatDate(event.date)}</div>
                                    <div class="opacity-90 font-medium text-sm">${statusText}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            eventsTimeline.innerHTML = timelineHTML;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('pt-PT');
        }

        function addToGoogleCalendar(e, index) {
            e.preventDefault();
            e.stopPropagation();
            
            const events = getAllEvents();
            const event = events[index];
            
            const eventName = getEventName(event.type);
            const title = `${eventName} - ${event.carName} (${event.licensePlate})`;
            
            // Create description based on event type
            let description = '';
            switch(event.type) {
                case 'inspection':
                    description = `Inspe√ß√£o peri√≥dica obrigat√≥ria do ve√≠culo ${event.carName} com matr√≠cula ${event.licensePlate}.`;
                    break;
                case 'insurance':
                    description = `Renova√ß√£o do seguro autom√≥vel do ve√≠culo ${event.carName} com matr√≠cula ${event.licensePlate}.`;
                    break;
                case 'iuc':
                    description = `Pagamento do Imposto √önico de Circula√ß√£o (IUC) do ve√≠culo ${event.carName} com matr√≠cula ${event.licensePlate}.`;
                    break;
            }

            // Format date for Google Calendar (YYYYMMDD)
            const date = new Date(event.date);
            const formattedDate = date.toISOString().slice(0, 10).replace(/-/g, '');
            
            // Create Google Calendar URL
            const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${formattedDate}/${formattedDate}&details=${encodeURIComponent(description)}&location=${encodeURIComponent('Portugal')}&sf=true&output=xml`;
            
            // Open in new tab
            window.open(googleCalendarUrl, '_blank', 'noopener,noreferrer');
        }

        function renderCars() {
            const carsList = document.getElementById('carsList');

            if (cars.length === 0) {
                carsList.innerHTML = '';
                return;
            }
            
            carsList.innerHTML = cars.map((car, index) => {
                const inspectionDays = getDaysUntil(car.inspectionDate);
                const insuranceDays = getDaysUntil(car.insuranceDate);
                const iucDays = getDaysUntil(car.iucDate);

                return `
                    <div class="glass-card rounded-3xl p-6 card-hover">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center space-x-4">
                                <div class="bg-slate-100 p-3 rounded-xl flex items-center justify-center w-16 h-16">
                                    ${getBrandIcon(car.brand, car.logo)}
                                </div>
                                <div>
                                    <h3 class="text-xl font-semibold text-slate-700 mb-1">${car.name}</h3>
                                    <p class="text-slate-500 font-medium text-base">${car.licensePlate}</p>
                                </div>
                            </div>

                        </div>

                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 rounded-xl ${getStatusClass(inspectionDays)}">
                                <div>
                                    <span class="font-semibold text-base">üîß Inspe√ß√£o</span>
                                    <p class="opacity-80 font-medium text-sm">${formatDate(car.inspectionDate)}</p>
                                </div>
                                <span class="font-semibold text-sm">${getStatusText(inspectionDays)}</span>
                            </div>

                            <div class="flex justify-between items-center p-3 rounded-xl ${getStatusClass(insuranceDays)}">
                                <div>
                                    <span class="font-semibold text-base">üõ°Ô∏è Seguro</span>
                                    <p class="opacity-80 font-medium text-sm">${formatDate(car.insuranceDate)}</p>
                                </div>
                                <span class="font-semibold text-sm">${getStatusText(insuranceDays)}</span>
                            </div>

                            <div class="flex justify-between items-center p-3 rounded-xl ${getStatusClass(iucDays)}">
                                <div>
                                    <span class="font-semibold text-base">üí∞ IUC</span>
                                    <p class="opacity-80 font-medium text-sm">${formatDate(car.iucDate)}</p>
                                </div>
                                <span class="font-semibold text-sm">${getStatusText(iucDays)}</span>
                            </div>
                        </div>

                        <div class="mt-6 grid grid-cols-2 gap-3">
                            <button onclick="editCar(${index})" class="bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold py-3 px-4 rounded-xl transition-all duration-300 hover:scale-105">
                                <span class="text-lg mr-2">‚úèÔ∏è</span>Editar
                            </button>
                            <button onclick="deleteCar(${index})" class="bg-red-100 hover:bg-red-200 text-red-700 font-bold py-3 px-4 rounded-xl transition-all duration-300 hover:scale-105">
                                <span class="text-lg mr-2">üóëÔ∏è</span>Apagar
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showDashboard() {
            document.getElementById('dashboardView').style.display = 'block';
            document.getElementById('carsView').style.display = 'none';
            document.getElementById('emptyState').style.display = cars.length === 0 ? 'block' : 'none';
            
            document.getElementById('dashboardBtn').className = 'px-8 py-3 rounded-xl font-semibold transition-all duration-300 bg-slate-200 text-slate-700 shadow-sm';
            document.getElementById('carsBtn').className = 'px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-slate-500 hover:text-slate-700 hover:bg-slate-100';
            
            renderDashboard();
        }



        function showCars() {
            document.getElementById('dashboardView').style.display = 'none';
            document.getElementById('carsView').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            
            document.getElementById('dashboardBtn').className = 'px-8 py-3 rounded-xl font-semibold transition-all duration-300 text-slate-500 hover:text-slate-700 hover:bg-slate-100';
            document.getElementById('carsBtn').className = 'px-8 py-3 rounded-xl font-semibold transition-all duration-300 bg-slate-200 text-slate-700 shadow-sm';
            
            renderCars();
        }

        let carToDelete = null;

        function deleteCar(index) {
            carToDelete = index;
            const car = cars[index];
            document.getElementById('confirmMessage').textContent = `Tem a certeza que deseja eliminar o ${car.name} (${car.licensePlate})?`;
            document.getElementById('confirmModal').classList.add('show');
        }

        function cancelDelete() {
            carToDelete = null;
            document.getElementById('confirmModal').classList.remove('show');
        }

        function confirmDelete() {
            if (carToDelete !== null) {
                cars.splice(carToDelete, 1);
                saveCars();
                renderCars();
                renderDashboard();
                
                // If no cars left, show empty state
                if (cars.length === 0) {
                    showDashboard();
                }
                
                carToDelete = null;
                document.getElementById('confirmModal').classList.remove('show');
            }
        }

        function editCar(index) {
            const car = cars[index];
            document.getElementById('carBrand').value = car.brand || '';
            document.getElementById('carModel').value = car.model || '';
            document.getElementById('licensePlate').value = car.licensePlate;
            document.getElementById('inspectionDate').value = car.inspectionDate;
            document.getElementById('insuranceDate').value = car.insuranceDate;
            document.getElementById('iucDate').value = car.iucDate;

            // Show existing logo if available
            const logoPreview = document.getElementById('logoPreview');
            if (car.logo) {
                logoPreview.innerHTML = `<img src="${car.logo}" alt="Logo" class="w-full h-full object-contain rounded">`;
            } else {
                logoPreview.innerHTML = 'Logo';
                logoPreview.className = 'w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-gray-400 text-xs';
            }

            // Store the index for editing
            document.getElementById('carForm').dataset.editIndex = index;

            // Change button text to indicate editing
            const submitButton = document.querySelector('#carForm button[type="submit"]');
            submitButton.innerHTML = '<span class="text-lg mr-2">‚úèÔ∏è</span>Atualizar Carro';

            // Scroll to form
            document.getElementById('carForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Logo preview functionality
        document.getElementById('brandLogo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('logoPreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Logo Preview" class="w-full h-full object-contain rounded">`;
                    preview.className = 'w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center overflow-hidden';
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = 'Logo';
                preview.className = 'w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-gray-400 text-xs';
            }
        });

        document.getElementById('carForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const brand = document.getElementById('carBrand').value;
            const model = document.getElementById('carModel').value;
            const carName = `${brand} ${model}`;
            
            const carData = {
                name: carName,
                brand: brand,
                model: model,
                licensePlate: document.getElementById('licensePlate').value,
                inspectionDate: document.getElementById('inspectionDate').value,
                insuranceDate: document.getElementById('insuranceDate').value,
                iucDate: document.getElementById('iucDate').value
            };

            // Handle logo upload
            const logoFile = document.getElementById('brandLogo').files[0];
            const editIndex = this.dataset.editIndex;
            
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    carData.logo = e.target.result;
                    saveCarData();
                };
                reader.readAsDataURL(logoFile);
            } else {
                // If editing and no new logo selected, keep existing logo
                if (editIndex !== undefined) {
                    carData.logo = cars[parseInt(editIndex)].logo;
                }
                saveCarData();
            }

            function saveCarData() {
                const button = document.querySelector('#carForm button[type="submit"]');
                const form = document.getElementById('carForm');
                
                if (editIndex !== undefined) {
                    // Editing existing car
                    cars[parseInt(editIndex)] = carData;
                    button.textContent = 'Carro Atualizado!';
                    delete form.dataset.editIndex;
                } else {
                    // Adding new car
                    cars.push(carData);
                    button.textContent = 'Carro Adicionado!';
                }

                saveCars();
                renderCars();
                renderDashboard();

                // Clear form and logo preview
                form.reset();
                const logoPreview = document.getElementById('logoPreview');
                logoPreview.innerHTML = 'Logo';
                logoPreview.className = 'w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-gray-400 text-xs';
                
                // Show success message
                button.classList.add('bg-green-600');
                button.classList.remove('bg-gray-900');
                
                setTimeout(() => {
                    button.innerHTML = '<span class="text-lg mr-2">üöó</span>Adicionar Carro';
                    button.classList.remove('bg-green-600');
                    button.classList.add('bg-gray-900');
                }, 2000);
            }
        });



        // Initialize app
        async function initApp() {
            await loadCars();
            showDashboard();
        }

        // Initial render
        initApp();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98acadded78ce3b0',t:'MTc1OTgzMjU2NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
